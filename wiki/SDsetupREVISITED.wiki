#summary Set up SD for Propforth.

= NOTICE =

You MUST have the PULL UP RESISTORS or it won't work.  Do I have you attention?  See below for the pull up resistors you must have.  Or it won't work.   Did I mention it won't work without the pull up resistors?

= HARDWARE =

== SD CARD tabs ==

The SD card tabs are the little gold contacts on the SD card.  Some folks call these pins but they are not pins. At least they don't look like pins to me, so I will call them TABS.  I will use PINS to refer to the I/O pins p0 through p31 on the propeller chip.  

== SD card connections ==

Set up an SD card or SD adapter per

http://code.google.com/p/propforth/wiki/PropToSDconnection

I'm using a full size SD adaptor as a card slot for microsd cards.

Looking at the bottom of the Full size SD adaptor with the gold tabs facing up and at the top of the card, the truncated corner is at the upper left. This is DAT2 and is usually numbered TAB9

== SD Card Tabs ==

Solder wires or pin headers to the SD adapter (or directly to the SD card if you are sure of yourself).

Remember, you need pull up resistors on the lines pointed out below, or it won't work. I use 10k ohm to 3.3 volt Vdd for my pull ups.  I happend to have a bag of 10k resistor packs, these work nicely. 

|| Prop Pin || TAB  || SPI function ||  description || Pull Up resistor? ||
|| Px|| tab9 || nc ||  not used in SPI mode || Pull Up resistor optional ||
|| Px|| tab1 || CS ||  Chip Select || Pull Up resistor- YES ||
|| Px|| tab2 || DI/MOSI || description || Pull Up resistor - YES ||
|| P-Vss || tab3 || Vss1 ||  GND ground || Pull Up resistor- no ||
|| P-Vdd || tab4 || Vdd ||  3.3 volts ||Pull Up resistor - (YES) ||
|| Px|| tab5 || Sclk ||  Serial Clock || Pull Up resistor - no ||
|| P-Vss || tab6 || Vss2 ||  GND ground || Pull Up resistor - no ||
|| Px|| tab7 || Do/MISO ||  description || Pull Up resistor - YES ||
|| Px|| tab8 || nc || not used in SPI mode  || Pull Up resistor optional ||

Notice:  If you use a resistor pack for the pull ups, you can connect the Vdd to the common on the resistor pack.  I usually bend up the pins on the resistor pack for the connections that do not take a pull up.  wasting a pins on a resistor pack is cheaper and easier than soldering individual resistors. 


== Spineret (standard) Pinout ==

Spineret was the first board we received that had an SD adapter on it, so we tried to use that as standard. 

|| Prop Pin || TAB  || SPI function ||  description || Pull Up resistor? ||
|| P16|| tab7 || Do/MISO ||  description || Pull Up resistor - YES ||
|| P17|| tab8 || nc || not used in SPI mode  || Pull Up resistor optional ||
|| P18|| tab9 || nc ||  not used in SPI mode || Pull Up resistor optional ||
|| P19|| tab1 || CS ||  Chip Select || Pull Up resistor- YES ||
|| P20|| tab2 || DI/MOSI || description || Pull Up resistor - YES ||
|| P21|| tab5 || Sclk ||  Serial Clock || Pull Up resistor - no ||
|| P-Vdd || tab4 || Vdd ||  3.3 volts ||Pull Up resistor - (YES) ||
|| P-Vss || tab3 || Vss1 ||  GND ground || Pull Up resistor- no ||
|| P-Vss || tab6 || Vss2 ||  GND ground || Pull Up resistor - no ||

== Demoboard ==

The Prop demo board only has  pins 0 through 7 available, so we move the pins accordingly

|| Prop Pin || TAB  || SPI function ||  description || Pull Up resistor? ||
|| P0|| tab7 || Do/MISO ||  description || Pull Up resistor - YES ||
|| P1|| tab8 || nc || not used in SPI mode  || Pull Up resistor optional ||
|| P2|| tab9 || nc ||  not used in SPI mode || Pull Up resistor optional ||
|| P3|| tab1 || CS ||  Chip Select || Pull Up resistor- YES ||
|| P4|| tab2 || DI/MOSI || description || Pull Up resistor - YES ||
|| P5|| tab5 || Sclk ||  Serial Clock || Pull Up resistor - no ||
|| P-Vdd || tab4 || Vdd ||  3.3 volts ||Pull Up resistor - (YES) ||
|| P-Vss || tab3 || Vss1 ||  GND ground || Pull Up resistor- no ||
|| P-Vss || tab6 || Vss2 ||  GND ground || Pull Up resistor - no ||

You don't have to start at pin 0. But you do have to end by pin 7.

== Quickstart ==

The quickstart has a double row of connectors, so we have to alternate pins.  Unfortunately, there are only 4 pins in a row, and we need six.  Do I have to make a special connector for the quickstart, or can we share? 

We can use the unassigned pins 8 through 14 or pins 9 through 15. If we can use all even or all odd pins, we can use the same connector from above on the quickstart. 

Pins 16 and 18 or 17 and 19 are physically connected to LEDs, those are connected to ground. So maybe we should use these.

Pins 4 and 6 or 5 and 7 are connected to resistive pad buttons.  If we don't touch the buttons, maybe these will work.

ALMOST

Since the Quickstart has Vin next to Vss, and my conneector is built for Vdd nest to Vss, I can't directly use my standard SD adapter  connector for the quickstart.  No worries, I'll just use a bread board and some jumpers.  



|| Prop Pin || TAB  || SPI function ||  description || Pull Up resistor? ||
|| P08|| tab7 || Do/MISO ||  description || Pull Up resistor - YES ||
|| P09 || tab8 || nc || not used in SPI mode  || Pull Up resistor optional ||
|| P10 || tab9 || nc ||  not used in SPI mode || Pull Up resistor optional ||
|| P11 || tab1 || CS ||  Chip Select || Pull Up resistor- YES ||
|| P12 || tab2 || DI/MOSI || description || Pull Up resistor - YES ||
|| P13 || tab5 || Sclk ||  Serial Clock || Pull Up resistor - no ||
|| P-Vdd || tab4 || Vdd ||  3.3 volts ||Pull Up resistor - (YES) ||
|| P-Vss || tab3 || Vss1 ||  GND ground || Pull Up resistor- no ||
|| P-Vss || tab6 || Vss2 ||  GND ground || Pull Up resistor - no ||


Testing....

NOTE: Quickstart boards do NOT ship with propforth in EEPROM.  


= Load the SD kernel =

In my case the path to the SD kernel is
{{{
C:\Documents and Settings\Braino\My Documents\Go-files\mygo\V5.3\CurrentRelease\PropForthSD
}}}
and the file is
{{{
PropForthSDFastSerialKernel.spin
}}}

This should be the same for v5.03 and 5.0.   The "GO" stuff in the path is an artifact from other testing, and you do not need any Go Language support installed for the SD support to run.

Use the SPIN TOOL to open the  SD kernel source file 
{{{
PropForthSDFastSerialKernel.spin
}}}

EDIT lines '125 thorugh 128' to match your hardware.  This is the prop pins where you put the SD card.  By default, we use 16, 17, 18, 19, 20, 21 per the spineret.  Pins 17 and 18 are not used in SPI mode, but we advise keeping the physical connections in place (until there is a valid reason to change). 

I'm using Quickstart with the SD on pins 8, 9, 10, 11, 12, 13.

So I change   
{{{
  dlrS_sd_cs = 19           ' $S_sd_cs forth word
  dlrS_sd_di = 20           ' $S_sd_di forth word
  dlrS_sd_clk = 21          ' $S_sd_clk forth word
  dlrS_sd_do = 16           ' $S_sd_do forth word
}}}
to
{{{
  dlrS_sd_cs  = 11           ' $S_sd_cs forth word
  dlrS_sd_di  = 12           ' $S_sd_di forth word
  dlrS_sd_clk = 13           ' $S_sd_clk forth word
  dlrS_sd_do  =  8           ' $S_sd_do forth word
}}}


into prop EEPROM.  Whe the firmware is loaded, power cycle and start teraterm.

Use the SPIN TOOL to install the SD kernel into prop EEPROM.  Whe the firmware is loaded, power cycle and start teraterm.





= Details =

Add your content here.  Format your content with:
  * Text in *bold* or _italic_
  * Headings, paragraphs, and lists
  * Automatic links to other wiki pages