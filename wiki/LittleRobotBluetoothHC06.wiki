#summary HC06 bluetooth cable replacement - slave only
#labels LittleRobot,v5.5,HC06,Bluetooth,SerialCableReplacement

<wiki:toc max_depth="9" />

= Summary =

So, these can be a little funky until you get used to them. Some don't seem to come up at 9600. 

FIRST: The RED LED must be flashing in order to talk to it. If the RED LED is NOT flashing, pull the ground wire and reconnect it.  

SECOND: CYCLE THE POWER. Pull the GND wire, and reconnect it.  Every other time, it goes into flashing (PAIRING) mode.  The HC06 needs to be in PAIRING mode to program it  

Third: Use the BlueTooth Helper from Propeller Powered.  When it works, its easy.  When it doesn't work, something else is the problem. Prably the Red LED isn't blinking.  Pull the GND wire and reconnect it , and try again. 

Fourth: Baud changes Immediately on HC06!!! Change baud LAST!!!

FIFTH: The HC06 does NOT auto-reconnected at power up.  After you power down, or disconnect the Quickstart, the HC06 FORGETS that it was connected to you android device.  You have to pull the ground wire to get the red LED to flash again in order to reconnect.  

Thanks to Boy Chance (Vic) for helping figure out the HC06.

These are the command I used in Bluetooth Helper (copy and paste to teraterm):
  * AT
  * AT+VERSION
  * AT+NAMEAnconaHC06-X
  * AT+PIN9999
  * AT+BAUD9
 
AT command produces  `ATOK` when it executes correctly

AT+VERSION comand procudes ` LinvorV1.5`  when it executes correctly

AT+NAMEAnconaHC06-X produces  `nameset` when it executes correctly

AT+PIN9999 produces  `setPIN` when it executes correctly

AT+BAUD9 produces  `230400` when it executes correctly

AFTER THE BAUD COMMAND, it stops restonding, as the baud changed to 230400 on the HC06, but the Bluetooth Helper is still at 9600.  CHANGE BAUD LAST!!!

= Diagnostic AFTER HC06 is set up for propforth =

So, you set up the HC06 using Bluetooth helper, set the name and the baud to 230400.  Now it won't connect to a new device. Maybe the number of devices (6) is already used up? Try deleteing all the old device paring as follows- - - 

== Set up a quick start ==

Load a Quickstat with the regular DEVkernel, so you can talk from the PC using teraterm. 

Set the HC06 forth scripts to run at 230400.

== Run the scripts, get the HC06 into programming mode ==

{{{ 
fl

\ for the HC06

\ green wire - this is not used on the carrier mounted modules
27 wconstant hcProgPin

\ white/orange wire - BOT1
0 wconstant hcRx

\ white/green wire - BOT1
2 wconstant hcTx

\ 9600 4/ wconstant hcBaud
230400 4/ wconstant hcBaud


0 wconstant hcSerialCog

hcSerialCog cogreset 100 delms
c" hcRx hcTx hcBaud serial" hcSerialCog cogx 100 delms


: hcSend
	cogid hcSerialCog iolink .cstr 1000 delms cogid iounlink cr
;

hcProgPin pinhi hcProgPin pinout

\ REMEMBER the HC06 LED must be blinking!
\ If it isn't , disconnect Gnd, and reconnect. It will blink

c" AT" hcSend
c" AT+VERSION" hcSend
c" AT+NAME?" hcSend

\ note baud change immediately on hc06!!!!!
\ don't do this until you've set everything else.
\ c" AT+BAUD9" hcSend

hcProgPin pinlo 

1000 delms

hcSerialCog cogreset 100 delms



hcProgPin pinlo


}}}

== Get Authenticated Device Count ==

Use Get Authenticated Device Count to see if maybe there were too many pairings already. Even if there is only one, resetting this seems to have made some units pair.

{{{
AT+ADCN?
}}}

== Delete all previously used device parings ==

Delete All Authenticated Device
{{{
AT+ RMAAD 
}}}

== reset any needed parametes ==

{{{

\ now set the baud to 230400 and see if it talks

230400 4/ wconstant hcBaud
c" hcRx hcTx hcBaud serial" hcSerialCog cogx 100 delms

\ c" AT+BAUD9" hcSend

hcProgPin pinhi hcProgPin pinout

\ c" AT+NAMEAnconaHC06-AA" hcSend
\ c" AT+PIN1234" hcSend
\ c" AT+PN" hcSend
\ c" AT" hcSend
\ c" AT+VERSION" hcSend
\ c" AT+NAMESanciHC06-0" hcSend
\ c" AT+PIN1111" hcSend
\ c" AT+PN" hcSend
\ c" AT+BAUD4" hcSend \ sets back to 9600 baud
\ 

}}}

== PAIR the HC06 with you  blue tooth device ==

Get your bluettoth device into scan (pairing) mode

get the HC06 RED LED to flash (pull the black wire if needed)

Pair as normal

== LAST - reburn the Propforth EEprom kernel with pin 0 for Rx and 2 fo Tx ==

Almost forgot!  Now that the module is paried with you device, we have to put the EEprom kernel back on! AND be sure you are using the EEprom kernel with the pins such that 

  * the HC06 Rx pin P0 is defined as the  Propforth Tx pin 0; 
  * and 
  * the HC06 Tx pin P2 is defined as the Propforth Rx pin P2


= DATA SHHET =

ftp://imall.iteadstudio.com/Modules/IM120723009/DS_IM120723009.pdf

= HC06 unmounted, no carrier board =

The original HC06 modules we used we not from PropellerPowered and were not mounted on carrirer boards.  Here's my notes.

== HC06 KEY is Scallop 26 ==

 Ancona uses Jeff's HC06. The HC06 is slave only, this is sufficient for Ancona's current needs. 

The HC06 from proleer Powered is mounted on a carrier board.  we might not have KEY brought out to a connection.  I think either STATE or WAKEUP might be KEY, so we could try the 3.3 before Vcc trick to get the default 38400 baud. 


These connections are already done when using the PropellerPowered HC06 modules, as they come mounted on a carrier board. Convenient!  

= HC06 module, unmounted =

Before we found the HC06 mounted on carrier at propeller powered, we used bare modules, and fashions our own carries.  This is much more fun, I was stuck for about two weeks. 

Connect:

|| HC06 Bluetooth module ||
|| HC06  || Prop || Wire Color||
||Pin 1 - TX  || P27 || Grey  || closest to Antenna ||
||Pin 2 - RX   || P26 || white||
||Pin 12 - 3.3v ||3.3v || Orange||
||Pin 13 - GND  || GND || Blue||
||Pin 26 - Key || P22  || Green|| ~~closest to Antenna~~ halfway up the side ||

Jeff's module implement n LED that flashed when unpaired and is lit when paired.  We can do this in software on propforth, aand/or do a discrete LED.  Also do this on HC05...



= PropellerPowered HC06 module setup =

Use the instructions and Bluetooth Helper from ProleelerPowered

https://www.dropbox.com/s/mm5b663t5u9w7k6/Bluetooth_Helper.zip

http://propellerpowered.com/shop/?page_id=1748

http://propellerpowered.com/forum/index.php?topic=386.0

*NOTE:* Be careful, you MUST set the BAUD Rate LAST.  After you change the baud rate, it stops talking at the current baud rate.  So your automatically done, whether you are or not. Don't even ask me how I know this. 

= setup HC06 (bare module, not carrier) =

Follow the instructions in Bluetooth-HC05-HC06.f

= BluetoothHC06.f = 

This is the code from BluetoothHC05-HC06.f, modified for HC06

{{{

fl

\ for the HC06

\ green wire
27 wconstant hcProgPin

\ white/orange wire
26 wconstant hcRx

\ white/green wire
25 wconstant hcTx

\ 9600 4/ wconstant hcBaud
230400 4/ wconstant hcBaud


0 wconstant hcSerialCog

hcSerialCog cogreset 100 delms
c" hcRx hcTx hcBaud serial" hcSerialCog cogx 100 delms


: hcSend
	cogid hcSerialCog iolink .cstr 1000 delms cogid iounlink cr
;

hcProgPin pinhi hcProgPin pinout

\ REMEMBER the HC06 LED must be blinking!
\ If it isn't , disconnect Gnd, and reconnect. It will blink

c" AT" hcSend
c" AT+VERSION" hcSend
c" AT+NAMEAnconaHC06-9" hcSend
c" AT+NAME?" hcSend
c" AT+PIN1234" hcSend
c" AT+PN" hcSend

\ note baud change immediately on hc06!!!!!
\ don't do this until you've set everything else.
\ c" AT+BAUD9" hcSend

hcProgPin pinlo 

1000 delms

hcSerialCog cogreset 100 delms

\ now set the baud to 230400 and see if it talks

230400 4/ wconstant hcBaud
c" hcRx hcTx hcBaud serial" hcSerialCog cogx 100 delms

hcProgPin pinhi hcProgPin pinout

c" AT" hcSend
c" AT+VERSION" hcSend
c" AT+NAMESanciHC06-0" hcSend
c" AT+PIN1111" hcSend
c" AT+PN" hcSend
\ c" AT+BAUD4" hcSend \ sets back to 9600 baud

hcProgPin pinlo

}}}


= Details =

Add your content here.  Format your content with:
  * Text in *bold* or _italic_
  * Headings, paragraphs, and lists
  * Automatic links to other wiki pages