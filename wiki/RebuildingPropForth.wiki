#summary Rebuilding PropForth - generating the spin code for the currently running image

= Rebuilding PropForth - generating the spin code for the currently running image =

  * Download PropForthPart1.f
  * Download PropForthPart2.f
  * Download [spinmaker].f

There are a few ways to do this, but we are going to take one path which modifies the original source code and regenerates the the spin code.

In the demo board the eeprom (those equipped with a 512k bit eeprom) there is 32k bytes of unused memory. This memory is used by PropForth as a "file system". A place to put routines which are handy, and necessary, but not used normally. We are going to put spinmaker.f into this "file system".

*reboot*
{{{
PropForth v2.0 2009APR19 11:00 1
Cog6 ok
}}}
*f_clear*
{{{
Cog6 ok
}}}

f_clear will clear out the upper 32k bytes of eeprom and initialize the file system. The next step is to open spinmaker.f, copy all of the text, and paste it into the terminal.

{{{
Cog6 ok
FW
10BD chars
Cog6 ok
}}}
*list*
{{{
8000 10AC spinmaker
9100
Cog6 ok
}}}
*forget build0*
{{{
Cog6 ok
}}}

forget build0 "forgets" the build0 and all the words after it, so we are back to an unmodified system. The next step is to open PropForthPart1.f, copy all of the text, and paste it into the terminal.

{{{
Cog6 ok
FL
363F chars
Cog6 ok

<<<Lots of text>>>

Cog6 ok
: decimal A mcwBase w! ;
Cog6 ok

Cog6 ok
}}}

The next step is to open PropForthPart2.f, find the boot6 word, and replace it with the boot6 word form the SavingPropForth exercise. It is also recommended you edit the version string to make sure you do not confuse the version you are working with. Now copy all of the text, and paste it into the terminal.

{{{
Cog6 ok
FL
1E7C chars
Cog6 ok

Cog6 ok

<<<Lots of text>>>

Cog6 ok
: lasm 4+ dup m@ swap 4+ swap over m@ dup mcwAhere w! do 4+ dup m@ a, loop drop ;
Cog6 ok

Cog6 ok
}}}

*load spinmaker*
{{{
Cog6 ok

<<<Lots of text>>>

 ."                         long    0,0, 0,0, 0,0, 0,0,  0,0, 0,0, 0,0, 0,0" cr
40 +loop cr ." ForthDictEnd" cr ." ForthMemoryEnd" cr cr else 3drop then ;
Cog6 ok
}}}

*spinmaker*
{{{

ForthDictStart

                        word    0

<<<Lots of text>>>

                        long    0,0, 0,0, 0,0, 0,0,  0,0, 0,0, 0,0, 0,0

ForthDictEnd
ForthMemoryEnd

Cog6 ok
}}}

Copy all of the text from !ForthDictStart to !ForthMemoryEnd in the terminal window.
Open PropForth.spin in the Propeller Tool, and paste in the text replacing all the text between !ForthDictStart to !ForthMemoryEnd in the current version. Recompile and load the eeprom.

*reboot*
{{{
PropForth v2.0 2009APR19 13:30 0
Cog6 ok
}}}
*free*
{{{
4337 bytes free - A3 cog longs free
Cog6 ok
}}}

As you may have noticed this take a lot longer than SavingPropForth, but you do get a few more bytes. This is because we replaced the boot6 routine rather than add another one to the dictionary.

This is should be an exercise used infrequently through the development cycle. Normally only when major fundamental changes are made.



