#summary General Documentation for Propforth.spin

= Introduction =

As of version 3.2, the entire PropForth file set is packaged into a single zip file download
[http://code.google.com/p/propforth/wiki/PropForthspin?ts=1279464157&updated=PropForthspin PropForth.spin] is contained in that archive. 

This page exists to have a place for Google Code to auto link the '[http://code.google.com/p/propforth/wiki/PropForthspin?ts=1279464157&updated=PropForthspin PropForth.spin]' text. 

This page contains more detailed explanations for user questions raised on the code. 

= Generating [http://code.google.com/p/propforth/wiki/PropForthspin?ts=1279464157&updated=PropForthspin PropForth.spin] =

The spinmaker word generates spin code for the currently running forth. Any words that were hidden by redefinition are discarded, so that no longer waste dictionary space. 

The generated spin code is pasted into [http://code.google.com/p/propforth/wiki/PropForthspin?ts=1279464157&updated=PropForthspin PropForth.spin] between aproximately line 840 beginning with the label

{{{ 
ForthDictStart
}}}

and ending at aproximately line 6207 with the label

{{{
ForthMemoryEnd
}}}

which is the last line of the file.

NOTICE that spinmaker only makes spincode, and does NOT preserve the comments in the previous version of the http://code.google.com/p/propforth/wiki/PropForthspin?ts=1279464157&updated=PropForthspin PropForth.spin] file.

This is because the comments are discarded when the source code is compiled and are not present in the dictionary for the spinmaker word to be aware of.

= 64k  EEPROM vs 32K EEPROM =

The stock demo board has a 32k EEPROM while the stock proto board has 64k EEPROM.
Version 2.4 of propforth used 64 byte EEPROM page writes, but this was found to be unsupported on the 32k EEPROM parts.  This was the cause of the 'saveforth' word failing on the demo boards.

Propfroth 2.5 onward uses 32 byte EEPROM page writes, which is supported on all EEPROM parts seen so far. The only impact is that the EEPROM write routine does twice as many page writes. 

If an application requires 64 byte page writes to EEPROM, this is controls in (about) line 5329 and 5339 in the saveforth word definition

{{{
                        word    @freeNFA + $10
saveforthNFA            byte    $89,"saveforth"
saveforthPFA            word    @cqPFA + $10
                        byte    $04,"here"
                        word    @findPFA + $10
                        word    (@a_zbranch - @a_base)/4
                        word    $0060
                        word    @versionPFA + $10
                        word    (@a_dup - @a_base)/4
                        word    @CatPFA + $10
                        word    @plusPFA + $10
                        word    (@a_dup - @a_base)/4
                        word    @CatPFA + $10
                        word    @oneplusPFA + $10
                        word    (@a_swap - @a_base)/4
                        word    @CbangPFA + $10
                        word    @pfagtnfaPFA + $10
                        word    @herePFA + $10
                        word    @WatPFA + $10
                        word    (@a_swap - @a_base)/4
                        word    (@a_dup - @a_base)/4
                        word    @WatPFA + $10
                        word    (@a_over - @a_base)/4
                        word    @EWbangPFA + $10
                        word    @twoplusPFA + $10
                        word    (@a_dup - @a_base)/4
                        word    (@a_litw - @a_base)/4
                       * word    $003F *
                        word    @andPFA + $10
                        word    @zeqPFA + $10
                        word    (@a_zbranch - @a_base)/4
                        word    $FFEA
                        word    (@a_twogtr - @a_base)/4
                        word    @iboundPFA + $10
                        word    @iPFA + $10
                        word    @minusPFA + $10
                        word    (@a_litw - @a_base)/4
                       * word    $0040 *
                        word    @minPFA + $10
                        word    (@a_dup - @a_base)/4
}}}   


change line  5239  from 

{{{ 
word    $003F ' page size for 32k EEPROM  
}}}

 to 

{{{    
word    $007F ' page size for 64k EEPROM  
}}}

change line  5339  from  

{{{ 
word    $0040 ' page size for 32k EEPROM  
}}}

 to  

{{{    
word    $0080 ' page size for 64k EEPROM  
}}}



= Version String =

The version string is located around line 5280 as seen in the Propeller Tool. 
If changes are made to the file it is recommended that this string be updated to the current date and time, or to some other unique value to differentiate the new version from the posted version. 

{{{
     byte    $20,"PropForth v3.2 2010JUL09 15:30 0"
}}}

 The $20 reserves 32 byte for the string.  This can be changed to accomodate any size string required.  

The FINAL CHARACTER should be a zero.  This final character is AUTO INCREMENTED by the 'saveforth' word. 


= Details =

Add your content here.  Format your content with:
  * Text in *bold* or _italic_
  * Headings, paragraphs, and lists
  * Automatic links to other wiki pages