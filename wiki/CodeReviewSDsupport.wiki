#summary The Code Review experiments for Propforth - 20110102 SD support
#labels SD,v4.0,Phase-Implementation

 == This review has not been started 20110102 ==
 == The review invitation has not been sent ==
 == Review Package is being prepared ==


= SD support =

Contributor caskaz considered the most capable regular contributor to propforth. He began working with forth around release 2.6, less than a year ago.  After implementing drivers for his NEC LCD screen, he decided to implement SD support for propforth. 
This is a non-trivial task. Depending on how far it is taken, it can lead to full FAT32 support.  Kye worked his SD driver in PASM and SPIN for a year before posting it.  So SD support in forth may take a bit of work, but doing it is the best way to learn what is going on.

----

= Please Read =

For Guidelines, Rules, and Code Review Preparation, Please see

http://code.google.com/p/propforth/wiki/CodeReview101

-----

 == Review Package for Code Review of SD Support ==

===Prerequisites: Hardware and software===

 * SDSC card - 1 Gig
 * SDHC card - 4 Gig
 * SD slot hardware configured as indicated in the review package
 * Propchip with 4 I/O pins free,  preferably 0, 1, 2, 3 so anyone with a demoboard may participate
 * Propforth v4.0x (in this case Propforth.spin is identical in Propforth4.0 and Propforth4.0a so either can be used)

 * MMC card is not supported


  No addition hardware or software is identified

  UPDATE: 
 * the SD review package may need fs.s loaded into the prop board's EEPROM.
 * the SD review package may need additional forth source files from the Propforth 4.0a parchive loaded into the fs.f EEPROM files system.

===Supporting References: SD functional definition===

   Comment by project member caskazsan, Jan 02, 2011: I recommend to read document about FAT & SD.  You don't need to understand all. Of course,I can't understand all too.

   AT32 File System Specification http://www.microsoft.com/whdc/system/platform/firmware/fatgen.mspx

   SD System Specification http://www.sdcard.org/home/

   How to use MMC/SDC http://elm-chan.org/docs/mmc/mmc_e.html

 If you don't understand, ask them please. I reply within areas I understand.

 You might be hard to find out SD-specification document.  Please do "I accept" on http://www.sdcard.org/developers/tech/sdcard/pls/

 Please download "Part 1 Physical Layer Simplified Specification Ver3.01".

 This pdf is big. Understanding everything is hard. Please read "chapter5 Card Registers" and "chapter7 SPI Mode". 


===Code: ===

  == ~~ http://propforth.googlecode.com/files/sd_loader_1.0a_20101225-2127.zip ~~ ==

  == http://propforth.googlecode.com/files/sd_loader_3.0_20110103-1437.zip ==

  This is the code from the parallax forums post http://forums.parallax.com/showthread.php?128055-Propforth4.0a-available-for-download&p=963390&viewfull=1#post963390

The source code being reviewed is found in the above zip file which contains eleven (11) files. Each will be reviewed separately as in the list below.   Moderator will attempt to order the list so that the files apear in the order they are used, initially the list contains the file in the order they appear in the zip archive.

 #  'About_sd_viewer.pdf'
 #  'DSCN8043.JPG'
 #  'curcuit0010.JPG'
 # 'Readme sd_loader_1.0a.txt'
 #  'sd_viewer_2.4a.f'
 #  'LogicAnalyzer.f'
 #  'sd_loader_1.0a.f'
 #  'Dump.f'
 #  'debug_tool.f'

Not Used -  should not be included in review package:
 #  'sd_loader_1.0a_1.f'
 #  'sd_loader_1.0a_2.f'


===Setup:===

  * User sets up test configuration of Prop, SD slot, and SD card
  * User load the SD support code in the order specified 

UPDATE: Per README sd_loader.txt:

 * Hardware
   # SD Card size 256M/512M/1G/2G/4G/16G formatted by manufacturer's utility; Cards formatted by Windows are not supported and might not work 
   # SD adapter wired per curcuit0010.JPG.  NOTE: 10k resistors and 0.1uF capacitor must be as close as possible to SD card.

 * Software
   # the software under test may be modified to match your hardware. See lines 11, 12, 13, 14 in 'sd_loader_1.0a.f'
   # Propforth.spin is loaded into EEPROM on prop board.
   # 'fs.f' (EEPROM file  system) is loaded into propforth and saveforth is executed
   # forth source files 'sd_viewer_2.4a.f', 'LogicAnalizer.f', 'Dump.f' are loaded on to SD card

NOTE: Files reside in a single cluster.  No file may be larger than the size of a cluster.  Since the largest file used is 22kb, the cluster size must be at least 32kb. 




===Inputs:  ===

  * User configures SD card to contain the various arrangements of directories and files as indicated 
  * User issues various commands as indicated

===Processing:===

 * Prop requests SD card information, SD card reads the information and presents it to the prop 
 * Prop requests SD card to save information, SD card writes the information and presents results to the prop 

===Outputs:===

 * Prop presents SD card outputs to the user display screen

===Results/Side affects:===

 * SD data is displayed on the terminal display
 * User data is stored on the SD card

-----

 == Review Schedule for Code Review of SD Support ==

 * Code Review for SD Support invitation *

Invitation will be by email.  Reply to email (within the allotted time?  How about 1 day from the invitation notification email?) to accept. 

Requested participants
 * *Required*  `prof_braino`
 * *Required*  `caskaz`
 * *Required*  `BrianRiley`
 * _Optional_  `salsanci`
 * _Optional_  `Ron Sutcliffe` (if Ron is interested I would like to make him a required participant)
 * _optional_  `any other interested parties`  


NOTE: After the initial review,  any person can continue to ask questions on the code under review and receive answers.  This is how new participants can be brought up to speed on the various sections of code.

Please respond indicating if 1 week is too little or too much to perform you part of the review.

Please prepare by reading the review materials by [1 week from last response]. It encouraged to respond earlier than the deadline.  The default time period is adjusted according to the experience, availability and timeliness of the participants.

Please prepare by submitting review questions to the Review Lead No Later than the Deadline date.   It encouraged to respond earlier than the deadline.  The default time period is adjusted according to the experience, availability and timeliness of the participants.

-----

 == Review Responses for Code Review of SD support ==

*Code Review for SD Support invitation*

`     Requested participants -------- RESPONSE` 

 * *Required*  `prof_braino: ---- Will participate 2011-Jan-02`
 * *Required*  `caskaz: --------- Will participate, caskaz is constructing a ZIP file with the SD code for review.
 * *Required*  `BrianRiley: ----- <not yet>`
 * _Optional_  `salsanci: -------- Sorry, out of town`
 * _Optional_  `Ron Sutcliffe: ---- <not yet>`
 * _optional_  `any other interested parties`:  

-----

 === Review Responses for Code Review of SD support ===

*Code Review QUESTIONS for SD support *


   <none submitted yet> 

----


 === Review Results for Code Review of SD Support ===

*Code Review for SD Support - Review Results


Please provide comments:
 * at the bottom of the page
 * by email
 * by anyother method

----

== Final Phase: Post Review == 

   Review comments received:  <not yet>

   Review comments actioned:  <not yet>

   Review actions  complete:  <not yet>

   Review actions  accepted:  <not yet>

Note:  "Review actions  accepted" means the person that made the original comment is happy with the result, and feels no further work is needed for the original point.

Please use this review as the reference on the material under review. 

Questions about this material may be submitted after review is complete. If you have a question, ask it. Other folks have the same question, and everybody can benefit from the answer if it gets posted.